{"version":3,"sources":["../app/application.js","../admin/common.js"],"names":["getStatusMsg","jqXHR","status_msg","$","parseJSON","responseText","e","_","resetAlert","parent","children","clearQueue","remove","removeClass","showAlert","type","sibling","msg","permanent","time","alert","first","clone","find","text","before","fadeIn","delay","slideUp","this","showWarning","showPermanentWarning","showSuccess","showPermanentSuccess","showError","form","closest","each","name","error","input","control","addClass","showTab","showCollapse","showPermanentError","btnError","btn","fadeOut","event","queue","dequeue","isFormInputEmpty","value","empty","attr","length","val","trim","isInvalidNumber","min","max","isInvalid","test","parseInt","collapse","isFormValid","valid","trigger","hasClass","tab","key","labels","update_attribute","element","regex","replace_str","new_attr","replace","update_attributes","query","escapeRegExp","string","dynamic_list_update_all_attributes","elements","base_id","count","regex_str","RegExp","toString","jquery_escaped_id","escapeJqueryId","href_regex","href_replace","i","id","updateAction","keep_value","action","changeInputFromTemplate","next","myid","oldInput","template","newInput","removeAttr","split","insertBefore","initWidgets","filter","chosen","allow_single_deselect","defaultTime","timepicker","showSeconds","showMeridian","datepicker","autoclose","bootstrapSwitch","submitFormHideModal","modal","ajax","async","url","data","serialize","always","done","window","hashchange","fail","animate","scrollTop","activateNavLink","hash","location","found","sort","a","b","href","link","indexOf","updateSection","ajax_data","doUpdateSection","section","loader","prev","show","fadeTo","hide","html","alert_section","prepend","updateSectionFromForm","pfOnHashChange","updater","default_url","undefined","updateDynamicRows","rows","index","tagName","option","updateDynamicRowsAfterRemove","table","tbody","bindExportCSV","doOnce","o","click","updateExtendedDurationExample","group","padZero","fromElement","fromDate","fromString","toElement","now","Date","getFullYear","getMonth","getDate","getHours","getMinutes","getSeconds","Math","floor","getTime","interval","unit","duration","is","period_base","e_duration","operator","join","searchSwitchesGenerator","errorSibling","process","json","all_or_any","searches.0.name","searches.0.op","searches.0.value","map","items","FingerbankSearch","on","mouseenter","toggleClass","mouseleave","toggle","dropdown","siblings","stopPropagation","String","prototype","asCSSIdentifier","jQuery","fn","extend","setBindId","gen_id","uniqueId","eventId","func","pfBindedEvents","proxy","_enableCategory","category","li","$section","redirectCallback","getResponseHeader","reload","ajaxSetup","timeout","cache","statusCode","401","302","item","preventDefault","target","target_wrapper","template_parent","template_control_group","copy","append","last","data_target","pickers","setStartDate","date","setEndDate","days","dp","nowDate","yyyy","m","d","dd","mm","beforeDate","format","before_str","update","now_str","updateDates","row","draggable","scope","handle","appendTo","cursor","helper","txt","push","droppable","accept","obj","dragIndex","dropIndex","delta","context","rowIndex","hoverClass","drop","ui","src","detach","dst","andSelf","dst_index","wrapper","last_index","src_index","console","log","insertAfter","row_model","row_new","that","stop","status","modal_id","content","confirm_link","off","form_id","button","str","setup","init","initModals","get","problems","severity","message","model_stripped","model","toLowerCase","search","path","headers","Accept","success","results","display","typeahead_field","typeahead_btn","add_to","add_action","typeahead","source","minLength","matcher","eval"],"mappings":"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","file":"pfappserver.js","sourcesContent":["$(function () {\n    /* Activate toggle buttons */\n    $('body').on(\n        {'mouseenter': function(event) {\n            var btn = $(this);\n            btn.text(btn.attr('toggle-hover'));\n            btn.toggleClass('btn-success btn-danger');\n         },\n         'mouseleave': function(event) {\n             var btn = $(this);\n             var value = $.trim(btn.text());\n             if (value == btn.attr('toggle-hover')) {\n                 btn.text(btn.attr('toggle-value-else'));\n                 btn.toggleClass('btn-success btn-danger');\n             }\n         },\n         'toggle': function(event) {\n             var btn = $(this);\n             var value = btn.attr('toggle-value');\n             btn.fadeOut('fast', function(event) {\n                 btn.text(btn.attr('toggle-value-else'));\n                 if (btn.hasClass('btn-danger'))\n                     btn.removeClass('btn-danger');\n             }).fadeIn('fast');\n             btn.attr('toggle-value', btn.attr('toggle-value-else'));\n             btn.attr('toggle-value-else', value);\n             value = btn.attr('toggle-hover');\n             btn.attr('toggle-hover', btn.attr('toggle-hover-else'));\n             btn.attr('toggle-hover-else', value);\n             value = btn.attr('toggle-href');\n             btn.attr('toggle-href', btn.attr('href'));\n             btn.attr('href', value);\n         }},\n        '.btn-toggle');\n\n    /* Activate button dropdowns */\n    $('.dropdown-toggle').dropdown();\n\n    /* Activate button groups */\n    $('body').on('click', '.btn-group .btn', function(event) {\n        var btn = $(this);\n        var name = btn.attr('name');\n        var input = btn.siblings('input[name=\"' + name + '\"]');\n        input.val(btn.attr('value'));\n        input.trigger('change');\n    });\n\n    /* Don't hide special \"form\" dropdown menu */\n    $('body').on('click', '.dropdown-menu-form', function(event) {\n        event.stopPropagation();\n    });\n\n    /* Live validation for required fields */\n    $('body').on('blur', 'input[data-required]', function() {\n        isFormInputEmpty($(this));\n    });\n    $('body').on('changeDate', 'input.datepicker[data-required]', function() {\n        isFormInputEmpty($(this));\n    });\n\n    /* Live validation for number fields */\n    $('body').on('blur', 'input[type=\"number\"]', function() {\n        var input = $(this);\n        var min = input.attr('min');\n        var max = input.attr('max');\n        if ($.trim(input.val()).length > 0)\n            isInvalidNumber(input, min, max);\n    });\n});\n\nfunction getStatusMsg(jqXHR) {\n    var status_msg;\n    try {\n        var obj = $.parseJSON(jqXHR.responseText);\n        status_msg = obj.status_msg;\n    }\n    catch(e) {}\n    if (!status_msg) status_msg = _(\"Cannot Load Content\");\n    return status_msg;\n}\n\nfunction resetAlert(parent) {\n    parent.children('.alert').clearQueue().remove();\n    parent.children('.error').removeClass('error');\n}\n\n\nfunction showAlert(type, sibling, msg, permanent, time) {\n    if (typeof time == \"undefined\") {\n        time = 5000;\n    }\n    var alert = $(type).first().clone();\n    alert.find('span').first().text(msg);\n    sibling.before(alert);\n    if (permanent)\n        alert.fadeIn('fast');\n    else\n        alert.fadeIn('fast').delay(time).slideUp('fast', function() { $(this).remove(); });\n}\n\nfunction showWarning(sibling, msg, permanent, time) {\n    showAlert('.alert-block', sibling, msg, permanent, time);\n}\n\nfunction showPermanentWarning(sibling, msg) {\n    showWarning(sibling, msg, true);\n}\n\nfunction showSuccess(sibling, msg, permanent, time) {\n    showAlert('.alert-success', sibling, msg, permanent, time);\n}\n\nfunction showPermanentSuccess(sibling, msg) {\n    showSuccess(sibling, msg, true);\n}\n\nfunction showError(sibling, msg, permanent, time) {\n    if (typeof time == \"undefined\") {\n        time = 10000;\n    }\n    if (typeof msg == 'string') {\n        showAlert('.alert-error', sibling, msg, permanent , time);\n    }\n    else {\n        var form = sibling.closest('form');\n        $.each(msg, function(name, error) {\n            var input = form.find('[name=\"' + name + '\"]');\n            var control = input.closest('.control-group');\n            control.addClass('error');\n            showTab(control, input);\n            showCollapse(input);\n            showAlert('.alert-error', sibling, error, permanent, time);\n        });\n    }\n}\n\nfunction showPermanentError(sibling, msg) {\n    showError(sibling, msg, true);\n}\n\nfunction btnError(btn) {\n    btn.fadeOut('fast', function(event) {\n        $(this).addClass('btn-danger');\n    }).fadeIn('fast').delay(5000).queue(function(event) {\n        $(this).removeClass('btn-danger');\n        $(this).dequeue();\n    });\n}\n\nfunction isFormInputEmpty(input) {\n    var control = input.closest('.control-group');\n    var empty = false;\n    var value;\n\n    if (input.attr('data-toggle') == 'buttons-radio')\n        value = input.find('.active').length === 0? null : 1;\n    else\n        value = input.val();\n\n    if (value === null ||\n        typeof value == 'string' && $.trim(value).length === 0 ||\n        value.length === 0) {\n        control.addClass('error');\n        empty = true;\n\n        // If input is in a tab, show the tab\n        showTab(control, input);\n    }\n    else {\n        control.removeClass('error');\n    }\n\n    return empty;\n}\n\nfunction isInvalidNumber(input, min, max) {\n    var control = input.closest('.control-group');\n    var isInvalid = false;\n\n    if (/^[0-9]+$/.test($.trim(input.val()))) {\n        var value = parseInt(input.val());\n        if (typeof min != \"undefined\" && value < min ||\n            typeof max != \"undefined\" && value > max)\n            isInvalid = true;\n    }\n    else {\n        isInvalid = true;\n    }\n    if (isInvalid) {\n        control.addClass('error');\n        showTab(control, input);\n    }\n    else {\n        control.removeClass('error');\n    }\n\n    return isInvalid;\n}\n\nfunction showCollapse(input) {\n    input.closest('.collapse').collapse('show');\n}\n\nfunction isFormValid(form) {\n    var valid = true;\n    form.find('input[data-required]:not(:disabled), input[type=\"number\"]:not(:disabled)').each(function() {\n        var input = $(this);\n        var control = input.closest('.control-group');\n        input.trigger('blur');\n        valid = !control.hasClass('error');\n        if (!valid) {\n            showCollapse(input);\n        }\n\n        return valid;\n    });\n    return valid;\n}\n\nfunction showTab(control, input) {\n    var tab = control.closest('.tab-pane');\n    if (tab) {\n        var a = tab.closest('form').find('.nav-tabs a[href=\"#' + tab.attr('id') + '\"]');\n        a.tab('show');\n        // Scroll to the input\n//        var container = tab.closest('.modal-body');\n//        if (!container)\n//            container = $(\"body,html\");\n//        container.animate({scrollTop: input.position().top}, 'fast');\n    }\n}\n\n/* Translate a string using the general \"labels\" array defined in the wrapper.tt template */\nfunction _(key) {\n    var value = key;\n    if (labels[key]) {\n        value = labels[key];\n    }\n\n    return value;\n}\n\nString.prototype.asCSSIdentifier = function() {\n    return this.replace(/[^_a-zA-Z0-9]/g, '_');\n};\n","/* -*- Mode: js; indent-tabs-mode: nil; js-indent-level: 4 -*- */\n/* jshint evil: true */\n\n/*\n * Update an action input field depending on the selected action type.\n * Used in\n * - config/authentication.js\n * - config/users.js\n */\n\nfunction update_attribute(element, name, regex, replace_str) {\n    var new_attr = element.attr(name);\n    if (new_attr !== null) {\n        new_attr = new_attr.replace(regex, replace_str);\n        element.attr(name, new_attr);\n    }\n}\n\nfunction update_attributes(element, name, query, regex, replace_str) {\n    update_attribute(element, name, regex, replace_str);\n    element.find(query).each(function(){\n        update_attribute($(this), name, regex, replace_str);\n    });\n}\n\n\nfunction escapeRegExp(string){\n    return string.replace(/([.*+?^=!:${}()|\\[\\]\\/\\\\])/g, \"\\\\$1\");\n}\n\nfunction dynamic_list_update_all_attributes(elements, base_id, count) {\n\n    /*\n     * Update id\n     */\n\n    elements.find('.sort-handle').first().text(count +1);\n    var regex_str = base_id + \"\\\\.\" + \"[0-9]+\";\n    var regex = new RegExp(regex_str);\n    var replace_str = base_id + \".\" + count.toString();\n    update_attributes(elements, \"id\", '[id*=\"' + base_id + '.\"]', regex, replace_str);\n    update_attributes(elements, \"data-base-id\", '[data-base-id*=\"' + base_id + '.\"]', regex, replace_str);\n    update_attributes(elements, \"data-template-parent\", '[data-template-parent*=\"' + base_id + '.\"]', regex, replace_str);\n    update_attributes(elements, \"name\", '[name^=\"' + base_id + '.\"]', regex, replace_str);\n    update_attributes(elements, \"for\", '[for^=\"' + base_id + '.\"]', regex, replace_str);\n\n    /*\n     * Update href and targets there are escaped\n     */\n    var jquery_escaped_id = escapeJqueryId(base_id + \".\");\n    var href_regex = new RegExp(escapeRegExp(jquery_escaped_id) + \"[0-9]+\");\n    var href_replace = jquery_escaped_id + count.toString();\n    $.each([\"data-template-control-group\", \"href\", \"data-target-wrapper\", \"data-target\", \"data-template-parent\", \"data-sortable-item\"], function(i, id) {\n        var query = '[' + id + '*=\"' + escapeJqueryId(jquery_escaped_id) + '\"]';\n        update_attributes(elements, id, query, href_regex, href_replace);\n    });\n}\n\nfunction updateAction(type, keep_value) {\n    var action = type.val();\n    var value = type.next();\n    changeInputFromTemplate(value, $('#' + action + '_action'), keep_value);\n}\n\nfunction escapeJqueryId( myid ) {\n    return myid.replace( /(:|\\.|\\[|\\]|,|=|\\\\)/g, \"\\\\$1\" );\n}\n\n\nfunction changeInputFromTemplate(oldInput, template, keep_value) {\n    var newInput = template.clone();\n    // Replace value field with the one from the templates\n    newInput.removeAttr('id');\n    newInput.attr('id', oldInput.attr('id'));\n    newInput.attr('name', oldInput.attr('name'));\n    newInput.attr('data-required', 1);\n    if (keep_value && oldInput.val()) {\n        if (newInput.attr('multiple')) {\n            newInput.val(oldInput.val().split(\",\"));\n        }\n        else {\n            newInput.val(oldInput.val());\n        }\n    }\n    newInput.insertBefore(oldInput);\n    oldInput.next(\".chzn-container\").remove();\n\n    // Remove previous field\n    oldInput.remove();\n    // Initialize rendering widgets\n    initWidgets(newInput);\n}\n\n/*\n * Initialize the rendering widgets of some elements\n */\nfunction initWidgets(elements) {\n    elements.filter('.chzn-select').chosen();\n    elements.filter('.chzn-deselect').chosen({allow_single_deselect: true});\n    elements.filter('.timepicker-default').each(function() {\n        // Keep the placeholder visible if the input has no value\n        var defaultTime = $(this).val().length? 'value' : false;\n        $(this).timepicker({ defaultTime: defaultTime, showSeconds: false, showMeridian: false });\n    });\n    elements.filter('.datepicker').datepicker({ autoclose: true });\n    if (elements.bootstrapSwitch)\n        elements.filter('.switch').bootstrapSwitch();\n}\n\nfunction submitFormHideModal(modal,form) {\n    $.ajax({\n        'async' : false,\n        'url'   : form.attr('action'),\n        'type'  : form.attr('method') || \"POST\",\n        'data'  : form.serialize()\n        })\n        .always(function()  {\n            modal.modal('hide');\n        })\n        .done(function(data) {\n            $(window).hashchange();\n        })\n        .fail(function(jqXHR) {\n            $(\"body,html\").animate({scrollTop:0}, 'fast');\n            var status_msg = getStatusMsg(jqXHR);\n            showError($('#section h2'), status_msg);\n        });\n}\n/* Trigger a mouse click on the active sidebar navigation link */\nfunction activateNavLink() {\n    var hash = location.hash;\n    var found = false;\n    if (hash && hash != '#') {\n        // Find the longest match\n        // Sort links by descending order by string length\n        $('.sidenav .nav a').sort(function(a,b) {\n           return b.href.length - a.href.length;\n        })\n        // Find the first link\n        .filter(function(i,link) {\n            if (false === found && hash.indexOf(link.hash) === 0) {\n                found = true;\n                return true;\n            }\n            return false;\n        }).trigger('click');\n    }\n    if (false === found) {\n        $('.sidenav .nav a').first().trigger('click');\n    }\n}\n\n/* Update #section using an ajax request */\nfunction updateSection(ajax_data) {\n    activateNavLink();\n    return doUpdateSection(ajax_data);\n}\n\nfunction doUpdateSection(ajax_data) {\n    var section = $('#section');\n    if (section) {\n        $(\"body,html\").animate({scrollTop:0}, 'fast');\n        var loader = section.prev('.loader');\n        loader.show();\n        section.fadeTo('fast', 0.5, function() {\n            $.ajax(ajax_data)\n                .always(function() {\n                    loader.hide();\n                    section.fadeTo('fast', 1.0);\n                    resetAlert(section);\n                })\n                .done(function(data) {\n                    section.html(data);\n                    section.find('.datepicker').datepicker({ autoclose: true });\n                    section.find('.timepicker-default').each(function() {\n                        // Keep the placeholder visible if the input has no value\n                        var defaultTime = $(this).val().length? 'value' : false;\n                        $(this).timepicker({ defaultTime: defaultTime, showSeconds: false, showMeridian: false });\n                    });\n                    if (section.chosen) {\n                        section.find('.chzn-select:visible').chosen();\n                        section.find('.chzn-deselect:visible').chosen({allow_single_deselect: true});\n                    }\n                    if (section.bootstrapSwitch)\n                        section.find('.switch').bootstrapSwitch();\n                    section.trigger('section.loaded');\n                })\n                .fail(function(jqXHR) {\n                    var status_msg = getStatusMsg(jqXHR);\n                    var alert_section = section.children('h1, h2, h3').first().next();\n                    if (alert_section.length === 0) {\n                        section.prepend('<h2></h2><div></div>');\n                        alert_section = section.children().first().next();\n                    }\n                    showPermanentError(alert_section, status_msg);\n                });\n        });\n    }\n    return true;\n}\n/* Update #section using an ajax request to a form */\nfunction updateSectionFromForm(form) {\n    updateSection({\n        'url'  : form.attr('action'),\n        'type' : form.attr('method') || \"POST\",\n        'data' : form.serialize()\n    });\n}\n\n\n/* Return a function to be called when the hash changes */\nfunction pfOnHashChange(updater, default_url) {\n    return function(event) {\n        var hash = location.hash;\n        var href = '/' + hash.replace(/^#\\/*/,'');\n        if (default_url !== undefined && (href === '' || href == '/')) {\n            href = default_url;\n        }\n        return updater(href,event);\n    };\n}\n\n/* Update sort handles and inputs indexes of sortable table */\nfunction updateDynamicRows(rows) {\n    rows.each(function(index, element) {\n        $(this).find('.sort-handle').first().text(index +1);\n        $(this).find(':input, [data-toggle=\"buttons-radio\"] > a').each(function() {\n            var input = $(this);\n            var name = input.attr('name');\n            var id = input.attr('id');\n            if(name) {\n                input.attr('name', name.replace(/\\.[0-9]+/, '.' + index ));\n            }\n            if(id) {\n                input.attr('id', id.replace(/\\.[0-9]+/, '.' + index ));\n            }\n            if (this.tagName == 'SELECT') {\n                $(this).find('option').each(function() {\n                    var option = $(this);\n                    var id = option.attr('id');\n                    if(id) {\n                        option.attr('id', id.replace(/\\.[0-9]+\\./, '.' + index + '.'));\n                    }\n                    var name = option.attr('name');\n                    if(name) {\n                        option.attr('name', name.replace(/\\.[0-9]+\\./, '.' + index + '.'));\n                    }\n                });\n            }\n        });\n    });\n}\n\nfunction updateDynamicRowsAfterRemove(table) {\n    var tbody = table.children(\"tbody\");\n    var rows = tbody.children(':not(.hidden)');\n    if(table.hasClass(\"table-sortable\") ) {\n        rows = rows.filter(\":has(.sort-handle)\");\n    }\n    updateDynamicRows(rows);\n    var count = rows.length;\n    if (count < 2) {\n        var id = '#' + table.attr('id') + 'Empty';\n        if ($(id).length) {\n            // The table can be empty\n            if (count === 0) {\n                if (tbody.prev('thead').length && tbody.attr('data-no-remove') != \"yes\" )\n                    table.remove();\n                $(id).removeClass('hidden');\n            }\n        }\n        else if (count == 1) {\n            // The table can't be empty\n            tbody.children(':not(.hidden)').find('[href=\"#delete\"]').addClass('hidden');\n        }\n    }\n}\n\njQuery.fn.extend({\n  setBindId : function() {\n    return this.each(function() {\n      var o = this;\n      // Ensure we don't bind the search twice by recording which IDs we've already set it up on\n      // The ID is generated and assigned to a data tag to make sure duplicate HTML ids don't break this flow even though they aren't valid\n      if(!$(o).attr('data-do-bind-id')) {\n        var gen_id = $(\"<a></a>\").uniqueId().attr('id');\n        $(o).attr('data-do-bind-id', gen_id);\n      } \n    });\n  },\n  /* \n   * Ensures that the function passes in parameter will only be executed once for an element of the DOM \n   * Useful to bind click events when objects load without double affecting the event to existing elements\n   *\n   */\n  doOnce : function(eventId, func) {\n    if(!$.pfBindedEvents) $.pfBindedEvents = {};\n    if(!$.pfBindedEvents[eventId]) $.pfBindedEvents[eventId] = {};\n\n    return this.each(function() {\n      var o = this;\n      $(o).setBindId();\n      if($.pfBindedEvents[eventId][$(o).attr('data-do-bind-id')]) {\n        return;\n      }\n      else {\n        $.pfBindedEvents[eventId][$(o).attr('data-do-bind-id')] = true;\n        $.proxy(func, this)();\n      }\n    });\n  },\n});\n\nfunction bindExportCSV() {\n  var btnClass = '.exportCSVBtn';\n  $(btnClass).doOnce(btnClass, function(){\n    var o = this;\n    $(o).click(function() {\n      window.location = $(o).attr('data-export-url')+'?'+$($(o).attr('data-export-form')).serialize()+\"&export=export\";\n    });\n  });\n}\n\nfunction updateExtendedDurationExample(group) {\n    var fromElement = $('#extendedFrom');\n    var fromDate = fromElement.data('date');\n    var fromString = fromElement.html();\n    var toElement = $('#extendedTo');\n\n    function padZero(i) { return (i < 10)? '0'+i : i; }\n\n    if (!fromDate) {\n        // Initialize the reference date\n        var now = new Date();\n        fromString =\n            now.getFullYear() + \"-\" + padZero(now.getMonth() + 1) + \"-\" + padZero(now.getDate()) + \" \" +\n            padZero(now.getHours()) + \":\" + padZero(now.getMinutes()) + \":\" + padZero(now.getSeconds());\n        fromElement.html(fromString);\n        fromDate = Math.floor(now.getTime()/1000);\n        fromElement.data('date', fromDate);\n    }\n\n    // Build duration representation\n    var interval = group.find('[name$=\".duration.interval\"]').val();\n    var unit = group.find('input[name$=\".duration.unit\"]').val();\n    if (interval && unit) {\n        var duration = interval + unit;\n        var day_base = group.find('[name$=\"day_base\"]').is(':checked');\n        if (day_base) {\n            var period_base = group.find('[name$=\"period_base\"]').is(':checked');\n            var e_duration = {\n                operator: group.find('[name$=\"operator\"]').val(),\n                interval: group.find('[name$=\"extended_duration.interval\"]').val(),\n                unit: group.find('input[name$=\"extended_duration.unit\"]').val()\n            };\n            duration += period_base? \"R\" : \"F\";\n            if (e_duration.operator && e_duration.interval && e_duration.unit) {\n                duration += (e_duration.operator == 'subtract')? \"-\" : \"+\";\n                duration += e_duration.interval + e_duration.unit;\n            }\n            else {\n                duration += '+0D';\n            }\n        }\n\n        group.data('duration', duration);\n\n        $.ajax(['/configuration', 'duration', fromDate, duration].join('/'))\n            .done(function(data) {\n                toElement.html(data.status_msg);\n            });\n    }\n    else {\n        toElement.html(fromString);\n    }\n}\n\nfunction searchSwitchesGenerator(errorSibling) {\n    return function(query, process) {\n        $.ajax({\n                url : '/config/switch/search',\n                type : 'POST',\n                data: {\n                    'json': 1,\n                    'all_or_any': 'any',\n                    'searches.0.name': 'id',\n                    'searches.0.op': 'like',\n                    'searches.0.value': query,\n                },\n            })\n            .done( function(data) {\n                var results = $.map(data.items, function(i) {\n                    return i.id;\n                });\n                process(results);\n            })\n            .fail(function(jqXHR) {\n                var status_msg = getStatusMsg(jqXHR);\n                showError(errorSibling, status_msg);\n            });\n    };\n}\n\n$(function () { // DOM ready\n\n    /* redirect to URL specified in the location header */\n    var redirectCallback =  function(jqXHR) {\n        var location = jqXHR.getResponseHeader('Location');\n        if (location)\n            // Reload the page and let the server render the proper template (most likely the login page)\n            window.location.reload(true);\n    };\n    /* Default values for Ajax requests */\n    $.ajaxSetup({\n        timeout: 120000,\n        cache: false,\n        statusCode: {\n            401: redirectCallback,\n            302: redirectCallback\n        }\n    });\n\n    /* Register links in the sidebar list */\n    function _enableCategory(category) {\n        // Activate corresponding category\n        $('.sidenav-category .active').filter(function(i, li) {\n            if ($(li).attr('data-category') != category)\n                $(li).removeClass('active');\n        });\n        $('.sidenav-category [data-category=\"' + category + '\"]').addClass('active');\n        // Show corresponding list of sections\n        $('.sidenav-section').each(function(i, section) {\n            var $section = $(section);\n            if ($section.attr('data-category') == category)\n                $section.show();\n            else\n                $section.hide();\n        });\n        $('.sidenav-section .active').removeClass('active');\n    }\n    $('.sidenav-category a').click(function(event) {\n        var li = $(this).parent();\n        var category = li.attr('data-category');\n        _enableCategory(category);\n        return true;\n    });\n    $('.sidenav-section a:not([data-toggle])').click(function(event) {\n        var item = $(this).parent();\n        var category = item.closest('.sidenav-section').attr('data-category');\n        _enableCategory(category);\n        item.addClass('active');\n        return true;\n    });\n\n    $('body').on('click', '[data-toggle=\"dynamic-list\"]', function(event) {\n        event.preventDefault();\n        var link = $(this);\n        var target = $(link.attr(\"data-target\"));\n        var target_wrapper = $(link.attr(\"data-target-wrapper\"));\n        var template_parent = $(link.attr(\"data-template-parent\"));\n        var template_control_group = $(link.attr(\"data-template-control-group\"));\n        var base_id = link.attr(\"data-base-id\");\n        var copy = template_parent.clone();\n        copy.removeAttr('id');\n        copy.find(':input').each(function(i,e) {\n            var input = $(e);\n            var template_parent = input.closest('[id^=\"dynamic-list-template\"]');\n            if (template_parent.length === 0) {\n                input.removeAttr('disabled');\n                input.removeClass('disabled');\n            }\n        });\n        var index = target.children().length;\n        dynamic_list_update_all_attributes(copy, base_id, index);\n        target.append(copy.children());\n        target.children().last().trigger('dynamic-list.add');\n        target_wrapper.removeClass('hidden');\n        template_control_group.addClass('hidden');\n        return false;\n    });\n\n\n    $('body').on('click', '[data-toggle=\"dynamic-list-delete\"]', function(event) {\n        event.preventDefault();\n        var link = $(this);\n        var target_wrapper = $(link.attr(\"data-target-wrapper\"));\n        var data_target = $(link.attr(\"data-target\"));\n        var base_id = link.attr(\"data-base-id\");\n        var siblings = data_target.siblings();\n        var template_control_group = $(link.attr(\"data-template-control-group\"));\n        data_target.remove();\n        if (siblings.length === 0) {\n            target_wrapper.addClass('hidden');\n            template_control_group.removeClass('hidden');\n        } else {\n            siblings.each(function(i,e) {\n                dynamic_list_update_all_attributes($(e), base_id, i);\n            });\n        }\n        return false;\n    });\n\n    /* Range datepickers\n     * See https://github.com/eternicode/bootstrap-datepicker/tree/range */\n\n    $('body').on('changeDate', '.datepicker input[name=\"start\"]', function(event) {\n        var dp = $(this).parent().data('datepicker');\n        // Limit the start date of the second datepicker to this new date\n        dp.pickers[1].setStartDate(event.date);\n    });\n    $('body').on('changeDate', '.datepicker input[name=\"end\"]', function(event) {\n        var dp = $(this).parent().data('datepicker');\n        // Limit the end date of the first datepicker to this new date\n        dp.pickers[0].setEndDate(event.date);\n    });\n    $('body').on('click', '.datepicker a[href*=\"day\"]', function(event) {\n        event.preventDefault();\n\n        // The number of days is extracted from the href attribute\n        var days = $(this).attr('href').replace(/#last([0-9]+)days?/, \"$1\");\n        var dp = $(this).closest('.datepicker').data('datepicker');\n        var nowDate = new Date();\n        var now = {\n            yyyy: nowDate.getFullYear(),\n            m: (nowDate.getMonth() + 1),\n            d: nowDate.getDate()\n        };\n        now.dd = (now.d < 10 ? '0' : '') + now.d;\n        now.mm = (now.m < 10 ? '0' : '') + now.m;\n        var beforeDate = new Date(nowDate.getTime() - days*24*60*60*1000);\n        var before = {\n            yyyy: beforeDate.getFullYear(),\n            m: (beforeDate.getMonth() + 1),\n            d: beforeDate.getDate()\n        };\n        before.dd = (before.d < 10 ? '0' : '') + before.d;\n        before.mm = (before.m < 10 ? '0' : '') + before.m;\n\n        // Start date\n        var format = dp.pickers[0].element.attr('data-date-format');\n        var before_str = format.replace('yyyy', before.yyyy).replace('mm', before.mm).replace('dd', before.dd);\n        dp.pickers[0].element.val(before_str);\n        dp.pickers[0].update();\n        dp.pickers[0].setEndDate(beforeDate);\n        dp.pickers[0].element.trigger({ type: 'changeDate', date: dp.pickers[0].date });\n\n        // End date\n        format = dp.pickers[1].element.attr('data-date-format');\n        var now_str = format.replace('yyyy', now.yyyy).replace('mm', now.mm).replace('dd', now.dd);\n        dp.pickers[1].element.val(now_str);\n        dp.pickers[1].update();\n        dp.pickers[1].setStartDate(nowDate);\n        dp.pickers[1].element.trigger({ type: 'changeDate', date: dp.pickers[1].date });\n\n        dp.updateDates();\n\n        return false;\n    });\n\n    /* Save the list order */\n    $('#section').on('admin.ordered', '.admin_ordered', function(event) {\n        var form = $(this).closest('form');\n        $.ajax({\n            type: 'POST',\n            url: form.attr('action'),\n            data: form.serialize()\n        }).done(function(data) {\n            resetAlert($('#section'));\n            showSuccess(form, data.status_msg);\n        }).fail(function(jqXHR) {\n            var status_msg = getStatusMsg(jqXHR);\n            showPermanentError(form, status_msg);\n        });\n    });\n\n    /* Activate sortable tables and lists (rows/items can be re-ordered) */\n    $('body').on('mousemove',\n                 '.table-sortable tbody tr:not(.ui-draggable), .list-sortable li:not(.ui-draggable)',\n                 function() {\n        var row = $(this);\n        var id = row.closest('table, ul').attr('id');\n        row.draggable({\n            scope: id,\n            handle: '.sort-handle',\n            appendTo: 'body',\n            cursor: 'move',\n            helper: function(event) {\n                var txt = [];\n                if (event.target.tagName == 'TD') {\n                    var row = $(event.target).closest('tr').first();\n                    row.find('td').each(function () {\n                        // Extract text from links, selects and static fields\n                        $(this).find('a[class!=\"btn-icon\"], :selected, .uneditable').map(function() {\n                            if (!$(this).hasClass('btn'))\n                                txt.push($(this).text());\n                        });\n                        // Extract text from input fields, except hidden and checkbox\n                        $(this).find('input[type!=\"hidden\"]:not(:checkbox)').map(function() {\n                            txt.push($(this).val());\n                        });\n                    });\n                }\n                else {\n                    var a = $(event.target).closest('li').find('a').first().clone();\n                    // Remove the sort-handle\n                    a.find('span').remove();\n                    txt.push(a.text());\n                }\n                return $('<div class=\"drag-row\">' + txt.join(' ') + '</div>');\n            }\n        });\n        row.siblings().droppable({\n            scope: id,\n            accept: function(obj) {\n                var delta = 0;\n                var dragIndex;\n                var dropIndex;\n                if (obj.context.tagName == 'TR') {\n                    dragIndex = obj.context.rowIndex;\n                    dropIndex = this.rowIndex;\n                    delta = dropIndex - dragIndex;\n                }\n                else {\n                    var items = $(this).closest('ul').children();\n                    dragIndex = items.index(obj);\n                    dropIndex = items.index(this);\n                    delta = dropIndex - dragIndex;\n                }\n                return (delta < 0 || delta > 1);\n            },\n            hoverClass: 'drop-row',\n            drop: function(event, ui) {\n                var src = ui.draggable.detach();\n                var dst = $(this);\n                src.insertBefore(dst);\n\n                // Update indexes\n                var rows = dst.siblings(':not(.hidden)').andSelf();\n                updateDynamicRows(rows);\n                dst.closest('table, ul').trigger('admin.ordered');\n            }\n        });\n    });\n\n    /* Activate sortable tables and lists (rows/items can be re-ordered) */\n    $('body').on('mousemove',\n                 '.dynamic-list-sortable .sort-handle:not(.ui-draggable)',\n                 function() {\n        var row = $(this);\n        var scope = row.attr('data-sortable-scope');\n        var item = $(row.attr('data-sortable-item'));\n        row.draggable({\n            scope: scope,\n            handle: '.sort-handle',\n            appendTo: 'body',\n            cursor: 'move',\n            helper: function(event) {\n                var target = $(event.target);\n                return '<div class=\"drag-row\">' + target.attr('data-sortable-text') + '</div>';\n            }\n        });\n        item.siblings().droppable({\n            scope: scope,\n            accept: function(obj) {\n                var text1 = $(obj.context).text();\n                return $(obj.context).text() != $(this).find('.sort-handle:first').text();\n            },\n            hoverClass: 'drop-dynamic-row',\n            drop: function(event, ui) {\n                var dst = $(this);\n                var dst_index = parseInt(dst.find('.sort-handle:first').text(), 10);\n                var draggable = ui.draggable;\n                var wrapper = $(draggable.attr('data-sortable-parent'));\n                var item = $(draggable.attr('data-sortable-item'));\n                var last_index = wrapper.children().length;\n                var base_id = draggable.attr(\"data-base-id\");\n                var src = item.detach();\n                var src_index = parseInt(src.find('.sort-handle:first').text(), 10);\n                console.log(src_index, dst_index, last_index);\n                if (dst_index == last_index) {\n                    wrapper.append(src);\n                }\n                else if(src_index < dst_index) {\n                    src.insertAfter(dst);\n                }\n                else {\n                    src.insertBefore(dst);\n                }\n                wrapper.children().each(function(i,e) {\n                    var element = $(e);\n                    dynamic_list_update_all_attributes(element, base_id, i);\n                });\n            }\n        });\n    });\n\n    /* Activate dynamic tables (rows can be added and removed) */\n    $('body').on('click', '.table-dynamic tbody [href=\"#add\"]', function(event) {\n        $(this).trigger(\"addrow\");\n        return false;\n    });\n\n    $('body').on('addrow', '.table-dynamic', function(event) {\n        var table = $(this);\n        var row = table.find(event.target).closest('tr');\n\n        var tbody = table.children('tbody');\n        var row_model = tbody.children('.hidden').first();\n        if (row_model) {\n            var row_new = row_model.clone();\n            row_new.removeClass('hidden');\n            row_new.find(':input').removeAttr('disabled');\n            row_new.find('.btn').removeClass('disabled');\n            if (row.length > 0) {\n                row_new.insertAfter(row);\n            } else {\n                row_new.insertBefore(row_model);\n            }\n            var rows = tbody.children(':not(.hidden)');\n            if (table.hasClass(\"table-sortable\") ) {\n                rows = rows.filter(\":has(.sort-handle)\");\n            }\n            updateDynamicRows(rows);\n            var count = rows.length;\n            if (count >= 2) {\n                table = tbody.closest('table');\n                var id = '#' + table.attr('id') + 'Empty';\n                if ($(id).length) {\n                    $(id).addClass('hidden');\n                }\n                tbody.children(':not(.hidden)').find('[href=\"#delete\"]').removeClass('hidden');\n            }\n            row_new.trigger('admin.added');\n        }\n        return false;\n    });\n\n    $('body').on('click', '.table-dynamic [href=\"#delete\"]', function(event) {\n        $(this).trigger(\"deleterow\");\n        return false;\n    });\n\n    $('body').on('deleterow', '.table-dynamic', function(event) {\n        var table = $(this);\n        var row = table.find(event.target).closest('tr');\n        var tbody = table.children('tbody');\n        row.fadeOut('fast', function() {\n            $(this).remove();\n            // Update sort handle if the table is sortable\n            //var empty = true;\n            updateDynamicRowsAfterRemove(table);\n            tbody.trigger('admin.deleted');\n        });\n        return false;\n    });\n\n    /* Activate links that trigger an ajax request and return a JSON status message */\n    $('#section').on('click','a.updates_section_status_msg', function() {\n        var that = $(this);\n        var href = that.attr('href');\n        var section = $('#section');\n        var sibling = that.parent().next();\n        var loader = section.prev('.loader');\n        if (loader) loader.show();\n        section.fadeTo('fast', 0.5);\n        $.ajax(href)\n        .always(function(){\n            if (loader) loader.hide();\n            section.stop();\n            section.fadeTo('fast', 1.0);\n        })\n        .done(function(data) {\n            showPermanentSuccess(sibling, data.status_msg);\n        })\n        .fail(function(jqXHR) {\n            var status_msg = getStatusMsg(jqXHR);\n            if (jqXHR.status == 404) {\n                showSuccess(sibling, status_msg);\n            }\n            else {\n                showPermanentError(sibling, status_msg);\n            }\n        });\n        return false;\n    });\n\n    $('#section').on('click', '.call-modal-confirm-link', function(event) {\n        var that = $(this);\n        if (that.hasClass('disabled'))\n            return false;\n        var url = that.attr('href');\n        var modal_id = that.attr('data-target');\n        var content  = that.attr('data-content');\n        var modal = $(modal_id);\n        modal.find('#content').html(content);\n        var confirm_link = modal.find('a.btn-primary').first();\n        modal.modal({ show: true });\n        confirm_link.off('click');\n        confirm_link.attr('href',url);\n        confirm_link.click(function() {\n            modal.modal('hide');\n        });\n        return false;\n    });\n\n    $('#section').on('click', '.call-modal-confirm-form', function(event) {\n        var that = $(this);\n        if (that.hasClass('disabled'))\n            return false;\n        var form;\n        var modal_id = that.attr('data-modal');\n        var form_id = that.attr('data-modal-form');\n        var modal    = $('#' + modal_id);\n        var content  = that.attr('data-content');\n        var confirm_link = modal.find('a.btn-primary').first();\n        if (form_id) {\n            form = $('#' + form_id);\n        } else {\n            form = that.closest('form');\n        }\n        if (content) {\n            modal.find('#content').html(content);\n        }\n        var valid = isFormValid(form);\n        if (valid) {\n            modal.modal({ show: true });\n            confirm_link.off('click');\n            confirm_link.click(function() {\n                $.ajax({\n                    'url'  : form.attr('action'),\n                    'type' : form.attr('method') || \"POST\",\n                    'data' : form.serialize()\n                })\n                    .always(function() {\n                        modal.modal('hide');\n                    })\n                    .done(function(data) {\n                        if (data.status_msg) {\n                            $(\"body,html\").animate({scrollTop:0}, 'fast');\n                            showSuccess($('h2').first().next(), data.status_msg);\n                        } else {\n                            $(window).hashchange();\n                        }\n                    })\n                    .fail(function(jqXHR) {\n                        $(\"body,html\").animate({scrollTop:0}, 'fast');\n                        var status_msg = getStatusMsg(jqXHR);\n                        showError($('#section h2'), status_msg);\n                    });\n                return false;\n            });\n        }\n        return false;\n    });\n\n    $('#section').on('click', '.call-modal', function(event) {\n        var that = $(this);\n        if (that.hasClass('disabled'))\n            return false;\n        var url = that.attr('href');\n        var modal_id = that.attr('data-modal');\n        var content  = that.attr('data-modal-content');\n        var modal = $('#' + modal_id);\n        if(content) {\n            modal.find('#content').html(content);\n        }\n        var confirm_link = modal.find('a.btn-primary').first();\n        modal.modal({ show: true });\n        confirm_link.off('click');\n        confirm_link.click(function() {\n            $.ajax(url)\n                .always(function() {\n                    modal.modal('hide');\n                })\n                .done(function(data) {\n                    $(window).hashchange();\n                })\n                .fail(function(jqXHR) {\n                    $(\"body,html\").animate({scrollTop:0}, 'fast');\n                    var status_msg = getStatusMsg(jqXHR);\n                    showError($('#section h2'), status_msg);\n                });\n            return false;\n        });\n\n        return false;\n    });\n\n    $('#section').on('click',\n        '[data-toggle=\"modal\"][data-target][data-href-background]',\n        function(event) {\n            var that  = $(this);\n            var href  = that.attr(\"data-href-background\");\n            var modal = $(that.attr(\"data-target\"));\n            var button = modal.find(\".btn-primary\").first();\n            button.off('click');\n            button.click(function() {\n                $.ajax(href)\n                    .done(function(data) {\n                        $(window).hashchange();\n                    })\n                    .fail(function(jqXHR) {\n                        $(\"body,html\").animate({scrollTop:0}, 'fast');\n                        var status_msg = getStatusMsg(jqXHR);\n                        showError($('#section h2'), status_msg);\n                    });\n            });\n    });\n\n    /* Add an extended duration to a text input field */\n    $('#section').on('click', '#addExtendedTime', function(event) {\n        var btn = $(this);\n        var group = btn.closest('.extended-duration');\n        var duration = group.data('duration'); // set in updateExtendedDurationExample\n        if (duration) {\n            var input = $(btn.data('target'));\n            var str = input.val();\n            var found = false;\n            $.each(str.split(/ *, */), function(index, value) {\n                if (value == duration) {\n                    found = true;\n                    return false;\n                }\n            });\n            if (!found)\n                input.val(str? str + \",\" + duration : duration);\n        }\n\n        return false;\n    });\n\n    /* Update any extended duration examples when loading section */\n    $('body').on('section.loaded', function(event) {\n        updateExtendedDurationExample($('.extended-duration'));\n        bindExportCSV();\n        FingerbankSearch.setup();\n    });\n\n    /* Update extended duration widget when changing parameters of the duration */\n    $('#section').on('change', '.extended-duration', function(event) {\n        var input = $(event.target);\n        var group = input.closest('.extended-duration');\n\n        if (input.is('[name$=\"day_base\"]')) {\n            // Advanced options are available only if \"relative to the beginning of the day\" is checked\n            var enabled = input.is(':checked');\n            if (enabled)\n                group.find('[name*=extended_duration], [name$=period_base]').removeAttr('disabled').removeClass('disabled');\n            else {\n                group.find('input[name*=extended_duration], select[name*=extended_duration], input[name$=period_base]').attr('disabled', 'disabled');\n                group.find('a[name*=extended_duration]').addClass('disabled');\n            }\n        }\n\n        updateExtendedDurationExample(group);\n    });\n\n    if (typeof init == 'function') init();\n    if (typeof initModals == 'function') initModals();\n\n    $('#checkup_dropdown_toggle').click(function () {\n      var li;\n      if($(this).closest('li').hasClass('open')) {\n        $.get(\"/admin/checkup\", function(data){\n          var dropdown = $('#checkup_dropdown');\n          dropdown.html('');\n          if(data.items.problems.length > 0){\n            for(var i in data.items.problems){\n              li = $('<li class=\"disabled\"><a href=\"#\">'+data.items.problems[i].severity+' : '+data.items.problems[i].message+'</a></li>');\n              dropdown.append(li);\n            }\n          }\n          else{\n            li = $('<li class=\"disabled\"><a href=\"#\">No problem detected !</a></li>');\n            dropdown.append(li);\n          }\n        });\n      }\n    });\n\n    $('#section').on('show', '.modal', function(e) {\n      FingerbankSearch.setup();\n    });\n\n});\n\nfunction FingerbankSearch() {\n\n}\n\nFingerbankSearch.prototype.model_stripped = function() {\n  var that = this;\n  return this.model.split('::Model::')[1].toLowerCase();\n};\n\nFingerbankSearch.prototype.search = function(query, process) {\n  var that = this;\n  var path = this.model_stripped();\n  console.log(path);\n  $.ajax({\n      type: 'POST',\n      url: '/config/fingerbank/'+path+'/typeahead_search',\n      headers: {\n          Accept: 'application/json',\n      },\n      data: {\n          'json': 1,\n          'query': query,\n          'model': this.model,\n      },\n      success: function(data) {\n          var results = $.map(data.items, function(i) {\n              return i.display;\n          });\n          that.results = data.items;\n          var input = that.typeahead_field;\n          var control = input.closest('.control-group');\n          if (results.length === 0)\n              control.addClass('error');\n          else\n              control.removeClass('error');\n          process(results);\n      }\n  });\n};\n\nFingerbankSearch.setup = function() {\n  $('.fingerbank-type-ahead').doOnce('.fingerbank-type-ahead', function(){ \n      var o = this;\n\n      // Creating a new scope since we are in a loop\n      (function() {\n        var search = new FingerbankSearch();\n        search.typeahead_field = $(o);\n        // We prevent the browser autocompletion\n        search.typeahead_field.attr('autocomplete', \"off\");\n        search.typeahead_btn = $($(o).attr('data-btn'));\n        search.model = $(o).attr('data-type-ahead-for');\n        search.add_to = $('#'+$(o).attr('data-add-to'));\n        search.add_action = $(o).attr('data-add-action');\n        $(o).typeahead({\n          source: $.proxy(search.search, search),\n          minLength: 2,\n          items: 11,\n          matcher: function(item) { return true; }\n        });\n        search.typeahead_btn.click(function(e) {\n          e.preventDefault();\n          var id;\n          var display;\n          console.log(search);\n          $.each(search.results, function(){\n            if(this.display == search.typeahead_field.val()){\n              id = this.id;\n              display = this.display;\n            }\n          });\n          if(search.add_action) {\n            eval(search.add_action + \"(search,id,display)\");\n          }\n          else {\n            search.add_to.append('<option selected=\"selected\" value=\"'+id+'\">'+display+'</option>');\n            search.add_to.trigger(\"liszt:updated\");\n          }\n          search.typeahead_field.val('');\n          return false;      \n        });\n      })();\n  });\n};\n"]}